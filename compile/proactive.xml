<?xml version="1.0" encoding="UTF-8"?>
<project name="ProActive" default="usage" basedir=".">
	<property name="base" value=".."/>
	<property name="src.dir" value="${base}/src"/>
	<property name="proactive.dir" value="org/objectweb/proactive"/>
	<property name="proactive.core.dir" value="${proactive.dir}/core"/>
	<property name="proactive.ext.dir" value="${proactive.dir}/ext"/>
	<property name="classes.dir" value="${base}/classes"/>
	<property name="dist.dir" value="${base}/dist"/>
	<property name="docs.dir" value="${base}/docs"/>
	<property name="name" value="ProActive"/>
	<property name="debug" value="on"/>
	<!-- define the classpath -->
	<path id="project.classpath">
		<pathelement path="${classpath}"/>
		<fileset dir="${base}/lib">
			<include name="*.jar"/>
		</fileset>
		<pathelement location="${base}/classes"/>
	</path>
	<!-- default target that displays usage -->
	<target name="usage">
		<echo message=""/>
		<echo message="================- ${name} =============="/>
		<echo message=""/>
		<echo message="Available targets are :"/>
		<echo message="  ------------------------------"/>
		<echo message="    General source file builds"/>
		<echo message="  ------------------------------"/>
		<echo message="  core     : ProActive core"/>
		<echo message="  ext      : ProActive ext"/>
		<echo message="  ic2d     : All IC2D"/>
		<echo message="  examples : All examples"/>
		<echo message="  all      : means all of the above"/>
		<echo message=""/>
		<echo message="  ------------------------------"/>
		<echo message="         Utility builds"/>
		<echo message="  ------------------------------"/>
		<echo message="  docs     : creates the docs directory with javadoc + doc"/>
		<echo message="  clean    : removes all build generated files"/>
		<echo message="  dist     : creates the distribution directory and files"/>
		<echo message=""/>
		<echo message="  ------------------------------"/>
		<echo message="    Special source file builds"/>
		<echo message="  ------------------------------"/>
		<echo message="  test"/>
		<echo message="  essai"/>
		<echo message="  migration"/>
		<echo message="  modelisation"/>
		<echo message="  util"/>
		<echo message="  alljunk  : means all of the above"/>
		<echo message="  ibis     : everything related to proactive ibis"/>
		<echo message=""/>
		<echo message="=========================================="/>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Initialisation
      ==
      ================================================================
	-->
	<target name="init">
		<!-- Create the time stamp -->
		<tstamp/>
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${classes.dir}"/>
		<echo message="--- Debugging is ${debug} ---"/>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile All
      ==
      ================================================================
	-->
	<target name="all" depends="ic2d, examples"/>
	<!--
	   ================================================================
	   ==
      ==  Compile ProActive Core
      ==
      ================================================================
	-->
	<target name="core" depends="init">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" deprecation="on" debug="${debug}">
			<classpath refid="project.classpath"/>
			<include name="*.java"/>
			<include name="${proactive.dir}/*.java"/>
			<include name="${proactive.dir}/jini/*.java"/>
			<include name="${proactive.dir}/rmi/*.java"/>
			<include name="${proactive.core.dir}/**/*.java"/>
		</javac>
		<rmic classname="org.objectweb.proactive.core.body.jini.JiniBodyImpl" base="${classes.dir}" sourcebase="${classes.dir}" stubversion="1.2">
			<classpath refid="project.classpath"/>
		</rmic>
		<rmic classname="org.objectweb.proactive.core.body.rmi.RemoteBodyImpl" base="${classes.dir}" sourcebase="${classes.dir}" stubversion="1.2">
			<classpath refid="project.classpath"/>
		</rmic>
		<rmic classname="org.objectweb.proactive.core.runtime.rmi.RemoteProActiveRuntimeImpl" base="${classes.dir}" sourcebase="${classes.dir}" stubversion="1.2">
			<classpath refid="project.classpath"/>
		</rmic>
		<rmic classname="org.objectweb.proactive.core.runtime.jini.JiniRuntimeImpl" base="${classes.dir}" sourcebase="${classes.dir}" stubversion="1.2">
			<classpath refid="project.classpath"/>
		</rmic>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile Extensions
      ==
      ================================================================
	-->
	<target name="ext" depends="core">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" deprecation="on" debug="${debug}">
			<classpath refid="project.classpath"/>
			<include name="${proactive.ext.dir}/**/*.java"/>
		</javac>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile ic2d
      ==
      ================================================================
	-->
	<target name="ic2d" depends="ext">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" includes="${proactive.dir}/ic2d/**/*.java" deprecation="on" debug="${debug}">
			<classpath refid="project.classpath"/>
		</javac>
		<copy todir="${classes.dir}/${proactive.dir}/ic2d/gui/images" includeEmptyDirs="no">
			<fileset dir="${src.dir}/${proactive.dir}/ic2d/gui/images"/>
		</copy>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile Examples
      ==
      ================================================================
	-->
	<target name="examples" depends="ext">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" includes="${proactive.dir}/examples/**/*.java" deprecation="on" debug="${debug}">
		<classpath refid="project.classpath"/>
		</javac>
		<copy todir="${classes.dir}/${proactive.dir}/examples" includeEmptyDirs="no">
			<fileset dir="${src.dir}/${proactive.dir}/examples">
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile test
      ==
      ================================================================
	-->
	<target name="test" depends="ext">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" includes="test/**" deprecation="on" debug="${debug}">
			<classpath refid="project.classpath"/>
		</javac>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile essai
      ==
      ================================================================
	-->
	<target name="essai" depends="ext">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" includes="essai/**" deprecation="on" debug="${debug}">
			<classpath refid="project.classpath"/>
		</javac>
		<copy todir="${classes.dir}/essai" includeEmptyDirs="no">
			<fileset dir="${src.dir}/essai">
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile migration
      ==
      ================================================================
	-->
	<target name="migration" depends="ext">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" includes="migration/**" deprecation="on" debug="${debug}"/>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile modelisation
      ==
      ================================================================
	-->
	<target name="modelisation" depends="ext, util">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" includes="modelisation/**" deprecation="on" debug="${debug}">
			<classpath refid="project.classpath"/>
		</javac>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile util
      ==
      ================================================================
	-->
	<target name="util" depends="">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" includes="util/**" deprecation="on" debug="${debug}"/>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile alljunk
      ==
      ================================================================
	-->
	<target name="alljunk" depends="all, migration, modelisation, essai, test"/>
	<!--
	   ================================================================
	   ==
      ==  Compile timer
      ==
      ================================================================
	-->
	<target name="timer">
		<mkdir dir="${src.dir}/util/timer/linux"/>
		<mkdir dir="${src.dir}/util/timer/solaris"/>
		<exec dir="${src.dir}/util/timer/linux/" executable="/usr/local/bin/gcc" os="Linux" output="output.txt">
			<arg line=" -shared -I/usr/local/jdk1.3/include/ -I/usr/local/jdk1.3/include/linux -o Util_timer_MicroTimer.o  ../util_timer_MicroTimer.cc"/>
		</exec>
		<exec dir="${src.dir}/util/timer/linux/" executable="/usr/bin/ld" os="Linux" output="output2.txt">
			<arg line="  -G Util_timer_MicroTimer.o -o  libUtil_timer_MicroTimer.so"/>
		</exec>
		<exec dir="${src.dir}/util/timer/solaris" executable="/usr/local/bin/gcc" os="SunOS" output="output.txt">
			<arg line="-G -I/usr/local/jdk1.3/include -I/usr/local/jdk1.3/include/solaris -o Util_timer_MicroTimer.o  ../util_timer_MicroTimer.cc"/>
		</exec>
		<exec dir="${src.dir}/util/timer/solaris" executable="/usr/ccs/bin/ld" os="SunOS" output="output.txt">
			<arg line="  -G  Util_timer_MicroTimer.o -o  libUtil_timer_MicroTimer.so"/>
		</exec>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Compile All
      ==
      ================================================================
	-->
	<target name="clean">
		<delete dir="${classes.dir}"/>
		<delete dir="${dist.dir}"/>
		<delete dir="${docs.dir}"/>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Create distribution bin
      ==
      ================================================================
	-->
	<target name="dist" depends="all">
		<!-- Create the distribution directory -->
		<delete dir="${dist.dir}"/>
		<mkdir dir="${dist.dir}"/>
		<property name="PAdist.dir" value="${dist.dir}/ProActive"/>
		<mkdir dir="${PAdist.dir}"/>
		<!-- Put everything in ${classes} into the ProActive-${DSTAMP}.jar file -->
		<jar jarfile="${PAdist.dir}/ProActive.jar">
			<fileset dir="${classes.dir}">
				<include name="${proactive.dir}/**"/>
				<exclude name="${proactive.dir}/examples/**"/>
				<exclude name="${proactive.dir}/ic2d/**"/>
			</fileset>
		</jar>
		<jar jarfile="${PAdist.dir}/ProActive_examples.jar" basedir="${classes.dir}" includes="${proactive.dir}/examples/**"/>
		<jar jarfile="${PAdist.dir}/ic2d.jar" basedir="${classes.dir}" includes="${proactive.dir}/ic2d/**"/>
		<!-- 
			copy docs / scripts / src / compile / lib 
		-->
		<copy todir="${PAdist.dir}" includeEmptyDirs="no">
			<fileset dir="${base}">
				<include name="docs/api/**"/>
				<!--include name="docs/ic2d-api/**"/-->
				<include name="scripts/**"/>
				<include name="src/org/**"/>
				<include name="compile/**"/>
				<include name="lib/**"/>
				<include name="descriptors/**"/>
			</fileset>
		</copy>
		<!-- 
			create zip version of ProActive without source
		-->
		<zip zipfile="${dist.dir}/ProActive_1_0_2.zip">
			<zipfileset dir="${PAdist.dir}/docs" prefix="ProActive/docs"/>
			<zipfileset dir="${PAdist.dir}/scripts" prefix="ProActive/scripts"/>
			<zipfileset dir="${PAdist.dir}/lib" prefix="ProActive/lib"/>
			<zipfileset dir="${PAdist.dir}/descriptors" prefix="ProActive/descriptors"/>
		</zip>
		<!-- 
			create zip version of ProActive with source
		-->
		<zip zipfile="${dist.dir}/ProActive-src_1_0_2.zip">
			<zipfileset dir="${PAdist.dir}" prefix="ProActive"/>
		</zip>
		<!-- 
			create zip version of ProActive doc 
		-->
		<zip zipfile="${dist.dir}/ProActiveDoc.zip">
			<zipfileset dir="${PAdist.dir}/docs" prefix="ProActive/docs"/>
		</zip>
		<!-- 
			copy PDF Manual 
		<copy file="${base}/docs/ProActiveManual.pdf" todir="${dist.dir}"/>
		-->
		<!--
			create zip version of ProActive Manual 
		<zip zipfile="${dist.dir}/ProActiveManual.zip" basedir="${dist.dir}" includes="ProActiveManual.pdf"/>
		-->
	</target>
	<!--
	   ================================================================
	   ==
      ==  Create javadoc
      ==
      ================================================================
	-->
	<target name="docs">
		<!-- Create the javadoc directory -->
		<delete dir="${docs.dir}"/>
		<mkdir dir="${docs.dir}"/>
		<mkdir dir="${docs.dir}/api"/>
		<mkdir dir="${docs.dir}/ic2d-api"/>
		<javadoc packagenames="org.objectweb.proactive,org.objectweb.proactive.core.*,org.objectweb.proactive.ext.*" sourcepath="${src.dir}" destdir="${docs.dir}/api" author="true" version="true" use="true" windowtitle="ProActive API" doctitle="ProActive 1.0.2&lt;br>&lt;a href=&quot;org/objectweb/proactive/doc-files/index.html&quot;>(documentation is here)&lt;/a>&lt;br>" bottom="&lt;i>Copyright &#169; May 2003 INRIA All Rights Reserved.&lt;/i>">
			<classpath refid="project.classpath"/>
			<group title="ProActive packages for end user" packages="org.objectweb.proactive"/>
			<group title="ProActive Core" packages="org.objectweb.proactive.core*"/>
			<group title="ProActive Core : Body" packages="org.objectweb.proactive.core.body*"/>
			<group title="ProActive Extensions" packages="org.objectweb.proactive.ext*"/>
			<group title="ProActive Extensions : Security (*under development*)" packages="org.objectweb.proactive.ext.security*"/>
		</javadoc>
		<javadoc packagenames="org.objectweb.proactive.ic2d.*" sourcepath="${src.dir}" destdir="${docs.dir}/ic2d-api" author="true" version="true" use="true" windowtitle="IC2D API" doctitle="ProActive 1.0.2 - IC2D" bottom="&lt;i>Copyright &#169; May 2003 INRIA All Rights Reserved.&lt;/i>">
			<classpath refid="project.classpath"/>
			<group title="IC2D Application : Interactive Control and Debugging of Distribution" packages="org.objectweb.proactive.ic2d*"/>
		</javadoc>
	</target>
	<!--
	   ================================================================
	   ==
      ==  Ibisc to generate stubs/skels
      ==
      ================================================================
	-->
	<target name="ibis">
		<!-- depends="ipl"> -->
		<delete>
			<fileset dir="${classes.dir}" includes="**/rmi*.java"/>
		</delete>
		<java classname="ibis.frontend.rmi.Main" fork="true" dir="${classes.dir}/org/objectweb/proactive/core/body/ibis/">
			<classpath refid="project.classpath"/>
			<arg value="org.objectweb.proactive.core.body.ibis.IbisRemoteBodyImpl"/>
		</java>
		<java classname="ibis.frontend.rmi.Main" fork="true" dir="${classes.dir}/org/objectweb/proactive/core/runtime/ibis/">
			<classpath refid="project.classpath"/>
			<arg value="org.objectweb.proactive.core.runtime.ibis.RemoteProActiveRuntimeImpl"/>
		</java>
		<javac srcdir="${classes.dir}" destdir="${classes.dir}" deprecation="on" debug="${debug}">
			<include name="**/*.java"/>
			<classpath refid="project.classpath"/>
		</javac>
	</target>
</project>
