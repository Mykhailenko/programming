<?xml version="1.0" encoding="UTF-8"?>
<ProActiveDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="DescriptorSchema.xsd">
	<componentDefinition>
		<virtualNodesDefinition>
			<virtualNode name="CPI" />
		</virtualNodesDefinition>
	</componentDefinition>
	<deployment>
		<mapping>
			<map virtualNode="CPI">
				<jvmSet>
					<vmName value="Jvm1" />
				</jvmSet>
			</map>
		</mapping>
		<jvms>
			<jvm name="Jvm1">
				<creation>
					<processReference refid="sshProcess" />
				</creation>
			</jvm>
		</jvms>
	</deployment>
	<FileTransferDefinitions>
		<FileTransfer id="transfer">
			<!-- Transfer mpi program on remote host -->
			<file src="cpi" dest="cpi" />
		</FileTransfer>
	</FileTransferDefinitions>
	<infrastructure>
		<processes>

			<!-- remote jvm Process -->
			<processDefinition id="jvmProcess">
				<jvmProcess class="org.objectweb.proactive.core.process.JVMNodeProcess">
					<jvmParameters>
						<parameter value="-Dproactive.useIPaddress=true" />
						<parameter value="-Dproactive.rmi.port=6099" />
					</jvmParameters>
				</jvmProcess>
			</processDefinition>

			<!-- pbs Process -->
			<processDefinition id="pbsProcess">
				<pbsProcess class="org.objectweb.proactive.core.process.pbs.PBSSubProcess">
					<processReference refid="jvmProcess" />
					<commandPath value="/opt/torque/bin/qsub" />
					<pbsOption>
						<hostsNumber>5</hostsNumber>
						<processorPerNode>1</processorPerNode>
						<bookingDuration>00:02:00</bookingDuration>
						<scriptPath>
							<absolutePath value="/home/smariani/pbsStartRuntime.sh" />
						</scriptPath>
					</pbsOption>
				</pbsProcess>
			</processDefinition>

			<!-- mpi Process -->
			<processDefinition id="mpiCPI">
				<mpiProcess class="org.objectweb.proactive.core.process.mpi.MPIDependentProcess" mpiFileName="cpi">
					<commandPath value="/usr/bin/mpirun" />
					<mpiOptions>
						<hostsNumber>5</hostsNumber>
						<localRelativePath>
							<relativePath origin="user.home" value="/ProActive/src/org/objectweb/proactive/examples/mpi" />
						</localRelativePath>
						<remoteAbsolutePath>
							<absolutePath value="/home/smariani" />
						</remoteAbsolutePath>
					</mpiOptions>
				</mpiProcess>
			</processDefinition>

			<!-- dependent process -->
			<processDefinition id="dpsCPI">
				<dependentProcessSequence class="org.objectweb.proactive.core.process.DependentListProcessDecorator">
					<processReference refid="pbsProcess" />
					<processReference refid="mpiCPI" />
				</dependentProcessSequence>
			</processDefinition>

			<!-- ssh process -->
			<processDefinition id="sshProcess">
				<sshProcess class="org.objectweb.proactive.core.process.ssh.SSHProcess" hostname="nef.inria.fr" username="smariani">
					<processReference refid="dpsCPI" />
					<FileTransferDeploy refid="transfer">
						<copyProtocol>scp</copyProtocol>
						<!-- local host path -->
						<sourceInfo prefix="/user/smariani/home/mpiPA/bin" />
						<!-- remote host path -->
						<destinationInfo prefix="/home/smariani" />
					</FileTransferDeploy>
				</sshProcess>
			</processDefinition>
		</processes>
	</infrastructure>
</ProActiveDescriptor>
